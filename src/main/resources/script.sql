DROP TABLE IF EXISTS user_connections;
DROP TABLE IF EXISTS transaction;
DROP TABLE IF EXISTS user;

CREATE TABLE user (
    id BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(100),
    email VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    account_balance DECIMAL(10,2) NOT NULL DEFAULT 0
);

CREATE TABLE transaction (
    id BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    sender BIGINT NOT NULL,
    receiver BIGINT NOT NULL,
    description TEXT,
    amount DECIMAL(10, 2) NOT NULL,
    transaction_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (sender) REFERENCES user (id) ON DELETE RESTRICT ON UPDATE CASCADE,
    FOREIGN KEY (receiver) REFERENCES user (id) ON DELETE RESTRICT ON UPDATE CASCADE
);

CREATE TABLE user_connections (
    user_id BIGINT NOT NULL,
    connection_id BIGINT NOT NULL,
    FOREIGN KEY (user_id) REFERENCES user (id) ON DELETE RESTRICT ON UPDATE CASCADE,
    FOREIGN KEY (connection_id) REFERENCES user (id) ON DELETE RESTRICT ON UPDATE CASCADE,
    PRIMARY KEY (user_id, connection_id)
);